{% load navbar_link %}
{% load group_filters %}

<!DOCTYPE html>
<html lang="es">

{% load static %}
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Restaurante{% endblock %}</title>
    <link rel="icon" href="{% static 'icons/favicon.ico' %}" type="image/x-icon">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
        rel="stylesheet"
    >
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <!-- CSS global -->
    <link rel="stylesheet" href="{% static 'menu_app/css/base.css' %}">
    <!-- Bloque para CSS de cada template "hijo" -->
    {% block extra_css %}{% endblock %}
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1"
    />
    <style>
        .navbar-blur {
            background-color: rgba(0, 0, 0, 0.7); /* Negro con transparencia */
            backdrop-filter: blur(8px); /* Aplica el efecto blur */
            -webkit-backdrop-filter: blur(8px); /* Soporte para Safari */
            }


        body {
            padding-top: 56px;  /* altura aproximada navbar */
            padding-bottom: 56px;  /* altura aproximada footer */
        }

        /* Fondo con imagen que cubre toda la ventana */
        .background-image {
            position: fixed;
            inset: 0;
            background: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1470&q=80') no-repeat center center fixed;
            background-size: cover;
            filter: brightness(0.7);
            z-index: -1;
        }
    </style>
</head>

<body class="d-flex flex-column min-vh-100">

    <link rel="preload" href="https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1470&q=80" as="image">


    <!-- Imagen de fondo fija -->
    <div class="background-image"></div>

    {% comment %} Mostrar navbar solo si usuario NO es Admin ni Cajero {% endcomment %}
    {% if not request.user.is_authenticated or request.user|has_group:"Cliente" %}
    <nav class="navbar navbar-expand-md navbar-dark navbar-blur fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/"><i class="bi bi-restaurant me-1"></i>Restaurante</a>

            <button
                class="navbar-toggler"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#navbar-content"
                aria-controls="navbar-content"
                aria-expanded="false"
                aria-label="Toggle navigation"
            >
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbar-content">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        {% navbar_link 'menu_app:menu' 'Menú' %}
                    </li>
                </ul>
                <div class="d-flex gap-2 ms-auto">
                    {% if request.user.is_authenticated %}
                        <a href="{% url 'bookings_app:make_reservation' %}" class="btn btn-light btn-sm">
                        <i class="bi bi-calendar-plus me-1"></i> Reservar
                        </a>
                        <a href="{% url 'make_order' %}" class="btn btn-light btn-sm">
                        <i class="bi bi-card-checklist me-1"></i> Pedir
                        </a>

                        <div class="dropdown">
                          <button class="btn btn-outline-light btn-sm dropdown-toggle"
                                type="button"
                                data-bs-toggle="dropdown"
                                aria-expanded="false">
                            <i class="bi bi-person me-1"></i> {{ request.user.username }}
                        </button>

                            <ul class="dropdown-menu dropdown-menu-end">
                            <a class="dropdown-item" href="{% url 'bookings_app:my_reservation' %}">
                            <i class="bi bi-calendar-check me-2"></i>Mis Reservas
                            </a>
                            <a class="dropdown-item" href="{% url 'accounts_app:user_notifications_list' %}">
                            <i class="bi bi-bell me-2"></i>Notificaciones
                            </a>
                            <a class="dropdown-item" href="{% url 'accounts_app:profile' %}">
                            <i class="bi bi-person-circle me-2"></i>Mi perfil
                            </a>

                                <li>
                                    <form method="post" action="{% url 'accounts_app:logout' %}">
                                        {% csrf_token %}
                                        <button type="submit" class="dropdown-item">Cerrar Sesión</button>
                                    </form>
                                </li>
                            </ul>
                        </div>
                    {% else %}
                        <a href="{% url 'accounts_app:login' %}" class="btn btn-outline-light btn-sm">
                        <i class="bi bi-box-arrow-in-right me-1"></i> Iniciar Sesión
                        </a>
                        <a href="{% url 'accounts_app:register' %}" class="btn btn-light btn-sm">
                        <i class="bi bi-pencil-square me-1"></i> Registrarse
                        </a>

                    {% endif %}
                </div>
            </div>
        </div>
    </nav>
    {% endif %}
    <main class="flex-grow-1">
        {% block content %}
        {% endblock %}
    </main>

    <!--
    <footer class="bg-primary text-light py-3 mt-auto fixed-bottom">
        <div class="container d-flex justify-content-between align-items-center">
            <div>
                <span class="me-2">Número de teléfono:</span>
                <span id="phoneNumber" 
                      data-bs-toggle="tooltip" 
                      data-bs-placement="top" 
                      title="Copiar" 
                      style="cursor: pointer; user-select: none;">
                  +54 123 456 7890
                </span>
            </div>
            <div>
                <a href="#" class="text-light me-3"><i class="bi bi-facebook"></i></a>
                <a href="#" class="text-light me-3"><i class="bi bi-twitter"></i></a>
                <a href="#" class="text-light"><i class="bi bi-instagram"></i></a>
            </div>
        </div>
    </footer>
    -->

    <script>
        const urls = {
                makeOrder: "{% url 'make_order' %}"
        };
      // Inicializa todos los tooltips de Bootstrap
      var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
      var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
      });

      /*
      // Evento al hacer click para copiar número al portapapeles y cambiar tooltip
      const phoneNumber = document.getElementById('phoneNumber');
      phoneNumber.addEventListener('click', function() {
        const number = phoneNumber.innerText;
        navigator.clipboard.writeText(number).then(() => {
          const tooltip = bootstrap.Tooltip.getInstance(phoneNumber);
          tooltip.setContent({ '.tooltip-inner': '¡Copiado!' });
          tooltip.show();
          setTimeout(() => {
            tooltip.setContent({ '.tooltip-inner': 'Copiar' });
            tooltip.hide();
          }, 1500);
        });
      });
      */
    </script>
    <!-- JS de Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-k6d4wzSIapyDyv1kpU366/PK5hCdSbCRGRCMv+eplOQJWyd1fbcAu9OCUj5zNLiq"
        crossorigin="anonymous"></script>
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!-- JS global -->
    <script src="{% static 'menu_app/js/base.js' %}"></script>
    <!-- Bloque para JS de cada template hijo -->
    {% block extra_js %}{% endblock %}
</body>
</html>